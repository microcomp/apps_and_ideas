{% ckan_extends %}
{% import 'macros/form.html' as form %}
{% set page = c.page %}
{%if h.extra_v() != {} %}
  {% set errors = h.extra_v()['errors'] %}
  {% set data = h.extra_v()['data'] %}
{%endif%}

{% block subtitle %}
    {{ _('Apps') }}
{% endblock %}

{% block breadcrumb_content %}
  {% if c.controller == 'ckanext.apps_and_ideas.apps:AppsController' %}
    <li><a href='/apps'>{{ _('Applications') }}</a>  </li>
  {% elif c.controller == 'ckanext.apps_and_ideas.detail:DetailController' %}
    <li><a href='/apps'>{{ _('Applications') }}</a> / {{ c.title }}</li>
  {% else %}
    <li>{{ _('Apps') }}</li>
  {% endif %}
{% endblock %}

{% block primary_content %}
{% if c.action == "new_app" %}
    {%snippet 'related/snippets/new_app.html', app_names=c.app_names, form = form, dataset = c.dataset, error_summary=error_summary, count=count, errors=errors, data=data%}
{% else %}
  <article class="module">
    <div class="module-content">
      <h1 class="page-heading">
        {% block page_heading %}

            {% if c.controller == 'ckanext.apps_and_ideas.apps:AppsController' and h.check_access('app_create') %}
              {{ _('Applications') }} <a class="btn btn-primary" href="/apps/new" style="color:white;float:right;"><span class="fa fa-plus-square"></span> {{_('New app')}}</a>
            {% elif c.controller == 'ckanext.apps_and_ideas.detail:DetailController' %}
              
            {% else %}
              {{ _('Apps') }}
            {% endif %}
        {% endblock %}
      </h1>
  {% if c.controller != 'ckanext.apps_and_ideas.detail:DetailController' %}

<style type="text/css">
.btn-search{  
    padding: 0.25em;
    color: white;
    background-color: #bd0a26;
    padding: 0.3em;
    padding-left: 0.6em;
    padding-right: 0.6em;
    margin: 0.7em;
    border: 1px solid #bd0a26;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    color: white;
    background-color: #bd0a26;
    margin-bottom: 1.5em;
}
</style>
    <form class="section site-search simple-input" action="/apps/search" method="get" >
            <!--div class="field"!-->
              {% if request.url.split("?")[1] %}
                {% for i in request.url.split("?")[1].split("&") %}
                {% if i.split('=')[0] != 'app_name' %}
                   <input id="{{i.split('=')[0]}}" type="text" name="{{i.split('=')[0]}}" value="{{i.split('=')[1]}}" style="display: none;"/> {%endif%}
                {%endfor%}
              {%endif%}
              <label for="field-sitewide-search">Search Applications</label>
              <input id="field-sitewide-search" type="text" name="app_name" placeholder="{% if c.name == "" %}Search{%else%}{{c.name}}{%endif%}"  style="display:inline; width: 80%;"/>
              
              <button class="btn-search" type="submit" style="display:inline;">{{_('Search')}}</button>        
    </form>
  {% endif %}

  {% block related_items %}
      {% if c.controller != 'ckanext.apps_and_ideas.detail:DetailController' %}
        {{super()}}
      {%endif%}
  {% endblock %}

  {% block related_list %}
    {% if c.controller == 'ckanext.apps_and_ideas.detail:DetailController' %}
      {%snippet "related/snippets/app_detail.html" , title=c.title, id=c.id, description=c.description, created=c.created, owner=c.owner, url=c.url, datasets=c.datasets, private=c.private , userobj=c.userobj %}
      {%snippet "related/snippets/comments2.html", data = [c.id, c.user, c.id, c.userobj.id] %}
    {% else %}
      {{super()}}
    {%endif%}
  {% endblock %}
          </div>

  {% block page_pagination %}
           {% if c.controller != 'ckanext.apps_and_ideas.detail:DetailController' %}
              {{ page.pager() }}
            {%endif%}
  {% endblock %}
        </article>
    {%endif%}

{% endblock %}

{% block secondary_content %}
{%if c.action!= 'new_app' %}
    {%if c.controller == 'ckanext.apps_and_ideas.detail:DetailController'%}
        {%if c.img != ''%}
          <aside class="secondary span3">
            <section class="module module-narrow module-shallow">
              <h2 class="module-heading"> {{_('Image')}}: </h1>
                <div class="module-content">
                  <img src="{{c.img}}" alt="app custom image" />
                </div>
            </section>
          </aside>
          {%endif%}
    {% else %}
      <section class="module module-narrow module-shallow">
        <h2 class="module-heading">{{ _('What are applications?') }}</h2>
        <div class="module-content">
          {% trans %}
            These are applications built with the datasets as well as ideas for
            things that could be done with them.
          {% endtrans %}
        </div>
      </section>

      <section class="module module-narrow module-shallow">
        <h2 class="module-heading">{{ _('Filter Results') }}</h2>
        <form action="/apps/search" method="get" class="module-content form-inline form-narrow section site-search simple-input">

          <input type='hidden' name='page' value='1'/>
         <div class="control-group" >
    {% if c.controller == 'ckanext.apps_and_ideas.apps:AppsController' %}
          <div class="control-group" hidden>
    {%else %}
    <div class="control-group">
    {% endif %}

            <label for="field-type">{{ _('Filter by type') }}</label>
            <select id="field-type" name="type">
              <option value="">{{ _('Default') }}</option>
              {% for option in c.type_options %}
                <option value="{{ option.value }}"{% if c.filters.type == option.value %} selected="selected"{% endif %}>{{ option.text or option.value }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="control-group">
            <label for="field-sort">{{ _('Sort by') }}</label>
            <select id="field-sort" name="sort">
              <option value="">{{ _('Default') }}</option>
              {% for option in c.sort_options %}
                <option value="{{ option.value }}"{% if c.filters.sort == option.value %} selected="selected"{% endif %}>{{ option.text or option.value }}</option>
              {% endfor %}
            </select>
          </div>
          {% if h.is_admin() %} 
              <input type="checkbox" id="field-private" name="private" 
              {%if c.filters is mapping  %}
                {% if c.filters.get('private') == 'on' %} checked="checked"{% endif %}>
              {% endif %}
              {{ _('Only show private items') }} 
          {% endif %}
         
         {% if request.url.split("?")[1] %}
            {% for i in request.url.split("?")[1].split("&") %}
                {% if i.split('=')[0] == 'app_name' %}
                    <input id="{{i.split('=')[0]}}" type="text" name="{{i.split('=')[0]}}" value="{{i.split('=')[1]}}" style="display: none;"/> 
                {%endif%}
            {%endfor%}
          {%endif%}
          <div class="form-actions">
            <button class="btn btn-primary">{{ _('Apply') }}</button>
            <a class="btn" href="/apps">{{ _('Cancel') }}</a>
          </div>
        </form>
      </section>
     {%endif%}
    {%endif%}
{% endblock %}

